language: java
jdk:
  - oraclejdk8

env:
  - PROFILE
services:
  - docker
  - postgresql

#before_install:
#  - cd java

install: true

before_script:
  - ./mvn clean install -B

stages:
  - develop
    if: (branch = develop) AND (type IN (push))
  - master_change
    if: (branch = master) AND (type IN (push))
    
  - master_with_tag
    if: (branch = master) AND (type IN (push))
    # we need to add tag recognition yet
    
  - other
    if:  ((branch != master) OR (branch != develop)) AND (type IN (push)) 

jobs:
  include:
    - stage: other
      script:
        - echo "run tests and build application"

    - stage: master_change
      script:
        - echo "run tests"
        
    - stage: master_with_tag
      script:
        - echo " run tests, build application, build docker image with commit tag and publish image"
    
    - stage: develop
      script:
        -echo "run tests, build application, build docker image with tag 'test' and publish image"
deploy: