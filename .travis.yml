language: java
jdk:
  - oraclejdk8

env:
  - PROFILE
services:
  - docker

install: true
jobs:
  include:
    - if: ((branch != master) OR (branch != develop)) AND (type IN (push)) 
      script:
        - cd backend/nokia-innovative-project
        - mvn clean install -B
    - if: (branch = master) AND (type IN (push))
      script:
        - cd backend/nokia-innovative-project
        - mvn clean install -B 
        - docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"
        - docker build -t backend .
        - docker tag backend innovativeprojectnokialibrary:backend $DOCKER_USERNAME/innovativeprojectnokialibrary
        - docker push $DOCKER_USERNAME/innovativeprojectnokialibrary
        - docker build -t frontend ../../frontend
        - docker tag frontend innovativeprojectnokialibrary:frontend $DOCKER_USERNAME/innovativeprojectnokialibrary
        - docker push $DOCKER_USERNAME/innovativeprojectnokialibrary
    - if: (branch = develop) AND (type IN (push))
      script:
        - cd backend/nokia-innovative-project
        - mvn clean install -B 
        - docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"
        - docker build -t backend .
        - docker tag backend innovativeprojectnokialibrary:backend $DOCKER_USERNAME/innovativeprojectnokialibrary
        - docker push $DOCKER_USERNAME/innovativeprojectnokialibrary:backendtest
        - docker build -t frontend ../../frontend
        - docker tag frontend innovativeprojectnokialibrary:frontend $DOCKER_USERNAME/innovativeprojectnokialibrary
        - docker push $DOCKER_USERNAME/innovativeprojectnokialibrary:frontendtest
cache:
   directories:
    - $HOME/.m2
